#!/bin/bash
# EPF Pre-commit Hook
# Version: 1.0.0
#
# This hook warns developers if their EPF framework is outdated.
# It does NOT block commits - just provides a warning.
#
# Installation (run from repo root):
#   ln -sf docs/EPF/scripts/hooks/pre-commit .git/hooks/pre-commit
#
# Or use the install script:
#   ./docs/EPF/scripts/install-hooks.sh

# Colors
YELLOW='\033[1;33m'
NC='\033[0m'

# Only run if EPF is installed
EPF_ROOT="$(git rev-parse --show-toplevel)/docs/EPF"
if [[ ! -d "$EPF_ROOT" ]]; then
    exit 0
fi

# Get local version
LOCAL_VERSION=""
if [[ -f "$EPF_ROOT/VERSION" ]]; then
    LOCAL_VERSION=$(cat "$EPF_ROOT/VERSION" | tr -d '\n\r')
fi

# Try to get canonical version (quick check - local canonical repo first)
CODE_DIR="${EPF_CODE_DIR:-$HOME/code}"
CANONICAL_VERSION=""

if [[ -f "$CODE_DIR/epf/VERSION" ]]; then
    CANONICAL_VERSION=$(cat "$CODE_DIR/epf/VERSION" | tr -d '\n\r')
fi

# Compare if we have both versions
if [[ -n "$LOCAL_VERSION" ]] && [[ -n "$CANONICAL_VERSION" ]]; then
    if [[ "$LOCAL_VERSION" != "$CANONICAL_VERSION" ]]; then
        echo ""
        echo -e "${YELLOW}⚠️  EPF Framework Outdated${NC}"
        echo -e "${YELLOW}   Local: v$LOCAL_VERSION | Canonical: v$CANONICAL_VERSION${NC}"
        echo -e "${YELLOW}   Run: ./docs/EPF/scripts/sync-repos.sh pull${NC}"
        echo ""
    fi
fi

# Always allow commit (this is a warning, not a blocker)
exit 0
