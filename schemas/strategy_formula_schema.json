{
  "version": "1.13.0",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Strategy Formula Schema",
  "description": "Defines the structure for documenting the winning formula in the STRATEGY phase. Supports both simple string-based entries and rich structured objects for detailed strategic documentation.",
  "type": "object",
  "properties": {
    "strategy": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the strategy"
        },
        "opportunity_id": {
          "type": "string",
          "description": "Reference to the opportunity this strategy addresses"
        },
        "informed_by_foundations": {
          "type": "string",
          "description": "Reference to the strategy foundations file"
        },
        "title": {
          "type": "string"
        },
        "last_updated": {
          "type": "string",
          "description": "ISO date of last update"
        },
        "positioning": {
          "type": "object",
          "properties": {
            "unique_value_proposition": {
              "type": "string"
            },
            "target_customer_profile": {
              "type": "string"
            },
            "category": {
              "type": "string",
              "description": "Legacy field - use category_position for richer format"
            },
            "category_position": {
              "type": "string",
              "description": "Detailed category positioning statement"
            },
            "positioning_statement": {
              "type": "string",
              "description": "Full positioning statement"
            },
            "tagline_candidates": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Potential taglines for marketing"
            }
          },
          "required": ["unique_value_proposition", "target_customer_profile"]
        },
        "competitive_moat": {
          "type": "object",
          "properties": {
            "advantages": {
              "type": "array",
              "description": "Competitive advantages - can be simple strings or detailed objects",
              "items": {
                "oneOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "object",
                    "properties": {
                      "name": {
                        "type": "string",
                        "description": "Short name for the advantage"
                      },
                      "description": {
                        "type": "string",
                        "description": "Detailed description of the advantage"
                      },
                      "defensibility": {
                        "type": "string",
                        "description": "Why this advantage is hard to replicate"
                      },
                      "evidence": {
                        "type": "string",
                        "description": "Evidence supporting this advantage"
                      }
                    },
                    "required": ["name", "description"]
                  }
                ]
              }
            },
            "differentiation": {
              "type": "string"
            },
            "vs_competitors": {
              "type": "array",
              "description": "Detailed competitor analysis",
              "items": {
                "type": "object",
                "properties": {
                  "competitor": {
                    "type": "string",
                    "description": "Competitor name"
                  },
                  "their_strength": {
                    "type": "string",
                    "description": "What they do well"
                  },
                  "our_angle": {
                    "type": "string",
                    "description": "How we differentiate"
                  },
                  "wedge": {
                    "type": "string",
                    "description": "Entry point / target segment"
                  },
                  "category": {
                    "type": "string",
                    "description": "Competitor category (e.g., enterprise, open-source, library)"
                  },
                  "key_differences": {
                    "type": "array",
                    "description": "Feature-by-feature comparison",
                    "items": {
                      "type": "object",
                      "additionalProperties": true
                    }
                  }
                },
                "required": ["competitor", "their_strength", "our_angle"]
              }
            },
            "competitive_positioning_summary": {
              "type": "object",
              "description": "Summary of competitive positioning strategy",
              "properties": {
                "category_definition": {
                  "type": "string"
                },
                "positioning_options": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "frame": {
                        "type": "string"
                      },
                      "description": {
                        "type": "string"
                      },
                      "audience": {
                        "type": "string"
                      }
                    }
                  }
                },
                "unique_combination": {
                  "type": "string"
                }
              }
            },
            "barriers_to_entry": {
              "oneOf": [
                {
                  "type": "string"
                },
                {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              ],
              "description": "What makes this hard for others to replicate"
            }
          }
        },
        "ecosystem_differentiation": {
          "type": "object",
          "description": "How the product fits into a larger ecosystem",
          "properties": {
            "summary": {
              "type": "string"
            },
            "ecosystem_components": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "component": {
                    "type": "string"
                  },
                  "role": {
                    "type": "string"
                  },
                  "standalone_value": {
                    "type": "string"
                  },
                  "ecosystem_value": {
                    "type": "string"
                  }
                }
              }
            },
            "ecosystem_synergies": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "synergy": {
                    "type": "string"
                  },
                  "how": {
                    "type": "string"
                  },
                  "unique_to_us": {
                    "type": "string"
                  }
                }
              }
            },
            "vs_point_solutions": {
              "type": "string"
            },
            "ecosystem_expansion_vectors": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "vector": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string"
                  },
                  "value_add": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "value_creation": {
          "type": "object",
          "properties": {
            "user_journey": {
              "oneOf": [
                {
                  "type": "string"
                },
                {
                  "type": "array",
                  "items": {
                    "oneOf": [
                      {
                        "type": "string"
                      },
                      {
                        "type": "object",
                        "properties": {
                          "step": {
                            "type": "string"
                          },
                          "description": {
                            "type": "string"
                          },
                          "value": {
                            "type": "string"
                          }
                        }
                      }
                    ]
                  }
                }
              ],
              "description": "User journey - can be a string or array of steps"
            },
            "key_capabilities": {
              "type": "array",
              "items": {
                "oneOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "object",
                    "properties": {
                      "capability": {
                        "type": "string"
                      },
                      "description": {
                        "type": "string"
                      },
                      "status": {
                        "type": "string",
                        "enum": ["planned", "building", "shipped", "mature"]
                      }
                    }
                  }
                ]
              }
            },
            "value_drivers": {
              "type": "array",
              "items": {
                "oneOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "object",
                    "properties": {
                      "driver": {
                        "type": "string"
                      },
                      "mechanism": {
                        "type": "string"
                      }
                    }
                  }
                ]
              }
            }
          },
          "required": ["key_capabilities"]
        },
        "business_model": {
          "type": "object",
          "properties": {
            "revenue_model": {
              "type": "string"
            },
            "pricing_strategy": {
              "type": "string"
            },
            "pricing_tiers": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "tier": {
                    "type": "string"
                  },
                  "target": {
                    "type": "string"
                  },
                  "price": {
                    "type": "string"
                  },
                  "features": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                }
              }
            },
            "unit_economics": {
              "oneOf": [
                {
                  "type": "string"
                },
                {
                  "type": "object",
                  "additionalProperties": true
                }
              ]
            },
            "growth_engines": {
              "type": "array",
              "items": {
                "oneOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "object",
                    "properties": {
                      "engine": {
                        "type": "string"
                      },
                      "mechanism": {
                        "type": "string"
                      },
                      "timeline": {
                        "type": "string"
                      }
                    }
                  }
                ]
              }
            }
          }
        },
        "constraints": {
          "type": "array",
          "items": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "object",
                "properties": {
                  "constraint": {
                    "type": "string"
                  },
                  "impact": {
                    "type": "string"
                  },
                  "response": {
                    "type": "string"
                  }
                }
              }
            ]
          }
        },
        "trade_offs": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "decision": {
                "type": "string"
              },
              "over": {
                "type": "string",
                "description": "What we're trading off against"
              },
              "rationale": {
                "type": "string"
              }
            }
          }
        },
        "risks": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "risk": {
                "type": "string"
              },
              "likelihood": {
                "type": "string",
                "enum": ["low", "medium", "high"]
              },
              "impact": {
                "type": "string",
                "enum": ["low", "medium", "high"]
              },
              "mitigation": {
                "type": "string"
              },
              "monitoring": {
                "type": "string",
                "description": "How we monitor for this risk"
              }
            },
            "required": ["risk", "mitigation"]
          }
        },
        "success_metrics": {
          "type": "object",
          "description": "Metrics to measure strategy success",
          "properties": {
            "leading_indicators": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "metric": {
                    "type": "string"
                  },
                  "target": {
                    "type": "string"
                  },
                  "rationale": {
                    "type": "string"
                  }
                }
              }
            },
            "lagging_indicators": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "metric": {
                    "type": "string"
                  },
                  "target": {
                    "type": "string"
                  },
                  "rationale": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "status": {
          "type": "string",
          "enum": ["draft", "validated", "active", "superseded"]
        },
        "confidence_level": {
          "type": "string",
          "enum": ["low", "medium", "high"]
        },
        "confidence_rationale": {
          "type": "string",
          "description": "Explanation for confidence level"
        },
        "next_validation_needed": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          ],
          "description": "What needs to be validated next"
        }
      },
      "required": ["id", "opportunity_id", "title", "positioning", "value_creation", "status"]
    },
    "change_log": {
      "type": "array",
      "description": "History of changes to this strategy document",
      "items": {
        "type": "object",
        "properties": {
          "date": {
            "type": "string",
            "description": "ISO date of change"
          },
          "changed_by": {
            "type": "string"
          },
          "sections_updated": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "reason": {
            "type": "string"
          },
          "consistency_validated": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "required": ["date", "changed_by", "reason"]
      }
    }
  },
  "required": ["strategy"]
}
