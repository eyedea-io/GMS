{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://emergentproductframework.com/schemas/aim_trigger_config_schema.json",
  "title": "AIM Trigger Configuration Schema",
  "description": "Configuration for data-driven AIM (Assessment & Calibration) triggers. EPF treats AIM as an investment decision—run it when ROI justifies cost, not just on calendar. This schema defines trigger conditions, thresholds, and monitoring cadences for each adoption level.",
  "type": "object",
  "required": [
    "metadata",
    "adoption_level",
    "calendar_trigger",
    "value_driven_triggers"
  ],
  "properties": {
    "metadata": {
      "type": "object",
      "required": ["version", "product_name", "last_updated"],
      "properties": {
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "EPF version (semver format)",
          "examples": ["2.0.0"]
        },
        "product_name": {
          "type": "string",
          "minLength": 2,
          "maxLength": 100,
          "description": "Product or organization name",
          "examples": ["AcmeApp", "InternalPlatform"]
        },
        "last_updated": {
          "type": "string",
          "format": "date",
          "description": "Last configuration update (YYYY-MM-DD)",
          "examples": ["2025-12-29"]
        },
        "owner": {
          "type": "string",
          "description": "Product leader responsible for trigger decisions",
          "examples": ["jane@example.com", "Product Team"]
        }
      }
    },
    "adoption_level": {
      "type": "integer",
      "minimum": 0,
      "maximum": 3,
      "description": "EPF adoption level (0: Solo founder, 1: Small team, 2: Growing startup, 3: Product org)",
      "examples": [1, 2]
    },
    "calendar_trigger": {
      "type": "object",
      "required": ["enabled", "cadence_days"],
      "description": "Baseline calendar-based trigger (quarterly minimum)",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether calendar trigger is active (should always be true)",
          "default": true
        },
        "cadence_days": {
          "type": "integer",
          "minimum": 30,
          "maximum": 120,
          "description": "Days between scheduled AIM sessions (typically 90 for quarterly)",
          "default": 90,
          "examples": [90, 60]
        },
        "next_scheduled": {
          "type": "string",
          "format": "date",
          "description": "Next scheduled AIM session date",
          "examples": ["2025-03-31"]
        }
      }
    },
    "value_driven_triggers": {
      "type": "object",
      "description": "Dynamic triggers based on ROI, assumptions, opportunities",
      "properties": {
        "roi_threshold_trigger": {
          "type": "object",
          "description": "Trigger AIM when potential waste exceeds threshold",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Whether ROI threshold trigger is active",
              "default": true
            },
            "aim_cost_usd": {
              "type": "number",
              "minimum": 100,
              "maximum": 5000,
              "description": "Estimated cost of running AIM session (hours × hourly rate)",
              "examples": [300, 600, 900]
            },
            "roi_multiplier": {
              "type": "number",
              "minimum": 5,
              "maximum": 100,
              "description": "Minimum ROI required to trigger (potential_waste / aim_cost)",
              "default": 20,
              "examples": [10, 20, 30]
            },
            "waste_threshold_usd": {
              "type": "number",
              "minimum": 1000,
              "description": "Calculated threshold: aim_cost × roi_multiplier (auto-computed)",
              "examples": [6000, 12000, 18000]
            },
            "monitoring_cadence": {
              "type": "string",
              "enum": ["daily", "weekly", "biweekly"],
              "description": "How often to check ROI threshold",
              "default": "weekly"
            },
            "waste_signals": {
              "type": "array",
              "description": "Signals indicating potential waste",
              "items": {
                "type": "object",
                "required": ["signal_name", "metric", "threshold"],
                "properties": {
                  "signal_name": {
                    "type": "string",
                    "description": "Name of the waste signal",
                    "examples": ["feature_adoption_below_target", "velocity_decline", "churn_spike"]
                  },
                  "metric": {
                    "type": "string",
                    "description": "Metric being monitored",
                    "examples": ["adoption_rate", "story_points_per_week", "monthly_churn_rate"]
                  },
                  "threshold": {
                    "type": "object",
                    "required": ["operator", "value"],
                    "properties": {
                      "operator": {
                        "type": "string",
                        "enum": ["<", ">", "<=", ">=", "!="],
                        "description": "Comparison operator"
                      },
                      "value": {
                        "type": ["number", "string"],
                        "description": "Threshold value (numeric or percentage)"
                      }
                    }
                  },
                  "cost_per_week": {
                    "type": "number",
                    "minimum": 0,
                    "description": "Estimated weekly waste if threshold breached (USD)",
                    "examples": [3000, 5000, 10000]
                  },
                  "weeks_remaining_in_cycle": {
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 13,
                    "description": "Weeks until next scheduled AIM (for waste calculation)"
                  }
                }
              }
            }
          }
        },
        "assumption_invalidation_trigger": {
          "type": "object",
          "description": "Trigger AIM when critical assumption fails (RAT result)",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Whether assumption invalidation trigger is active",
              "default": true
            },
            "critical_assumptions": {
              "type": "array",
              "description": "List of assumptions that trigger immediate AIM if invalidated",
              "items": {
                "type": "object",
                "required": ["assumption_id", "assumption_text", "criticality"],
                "properties": {
                  "assumption_id": {
                    "type": "string",
                    "description": "Reference to assumption in roadmap (e.g., roadmap.assumptions[0].id)",
                    "examples": ["asmp-001", "target-persona-has-problem"]
                  },
                  "assumption_text": {
                    "type": "string",
                    "minLength": 10,
                    "description": "Human-readable assumption statement",
                    "examples": ["Target users (enterprise CTOs) have budget authority for security tools"]
                  },
                  "criticality": {
                    "type": "string",
                    "enum": ["critical", "high", "medium"],
                    "description": "Critical = immediate AIM, High = AIM within 1 week, Medium = quarterly"
                  },
                  "test_method": {
                    "type": "string",
                    "description": "How assumption is being tested",
                    "examples": ["user_interviews", "prototype_test", "analytics_threshold"]
                  },
                  "invalidation_criteria": {
                    "type": "string",
                    "description": "What result counts as invalidation",
                    "examples": ["<30% of interviews confirm", "adoption <10% after 2 weeks", "NPS <20"]
                  }
                }
              }
            },
            "response_time_hours": {
              "type": "integer",
              "minimum": 1,
              "maximum": 168,
              "description": "Max hours to wait before running AIM after critical assumption fails",
              "default": 24,
              "examples": [4, 24, 72]
            }
          }
        },
        "opportunity_trigger": {
          "type": "object",
          "description": "Trigger AIM when unexpected high-value signal emerges",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Whether opportunity trigger is active",
              "default": true
            },
            "opportunity_signals": {
              "type": "array",
              "description": "Signals indicating strategic pivot opportunity",
              "items": {
                "type": "object",
                "required": ["signal_name", "impact_multiplier"],
                "properties": {
                  "signal_name": {
                    "type": "string",
                    "description": "Type of opportunity signal",
                    "examples": ["unexpected_use_case", "viral_feature", "competitor_pivot", "market_shift"]
                  },
                  "detection_method": {
                    "type": "string",
                    "description": "How opportunity is detected",
                    "examples": ["user_feedback_theme", "adoption_spike", "sales_inquiry_pattern"]
                  },
                  "impact_multiplier": {
                    "type": "number",
                    "minimum": 2,
                    "description": "Estimated impact vs current plan (e.g., 10 = 10x larger market)",
                    "examples": [5, 10, 20]
                  },
                  "confidence_threshold": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1,
                    "description": "Minimum confidence required to trigger AIM (0-1 scale)",
                    "default": 0.7,
                    "examples": [0.6, 0.7, 0.8]
                  }
                }
              }
            },
            "response_time_days": {
              "type": "integer",
              "minimum": 1,
              "maximum": 14,
              "description": "Max days to wait before evaluating opportunity via AIM",
              "default": 3,
              "examples": [1, 3, 7]
            }
          }
        },
        "cross_team_dependency_trigger": {
          "type": "object",
          "description": "Trigger AIM when cross-team dependencies break (Level 3 only)",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Whether cross-team dependency trigger is active (typically Level 3 only)",
              "default": false
            },
            "dependency_check_cadence": {
              "type": "string",
              "enum": ["daily", "weekly", "biweekly"],
              "description": "How often to validate cross-team dependencies",
              "default": "weekly"
            },
            "critical_dependencies": {
              "type": "array",
              "description": "Dependencies that trigger AIM if broken",
              "items": {
                "type": "object",
                "required": ["dependency_id", "dependent_team", "provider_team"],
                "properties": {
                  "dependency_id": {
                    "type": "string",
                    "description": "Unique identifier for dependency",
                    "examples": ["dep-platform-auth", "dep-payment-api"]
                  },
                  "dependent_team": {
                    "type": "string",
                    "description": "Team waiting for dependency",
                    "examples": ["Team-Mobile", "Team-Enterprise"]
                  },
                  "provider_team": {
                    "type": "string",
                    "description": "Team providing dependency",
                    "examples": ["Team-Platform", "Team-Infra"]
                  },
                  "required_by_date": {
                    "type": "string",
                    "format": "date",
                    "description": "Date dependent team needs capability",
                    "examples": ["2025-06-30"]
                  },
                  "slack_days": {
                    "type": "integer",
                    "minimum": 0,
                    "description": "Days of buffer before triggering AIM",
                    "default": 14,
                    "examples": [7, 14, 30]
                  }
                }
              }
            }
          }
        }
      }
    },
    "notification_settings": {
      "type": "object",
      "description": "How to notify when triggers fire",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true
        },
        "notification_channels": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["channel_type"],
            "properties": {
              "channel_type": {
                "type": "string",
                "enum": ["email", "slack", "teams", "webhook"],
                "description": "Notification delivery method"
              },
              "target": {
                "type": "string",
                "description": "Email address, Slack channel, or webhook URL",
                "examples": ["pm-team@example.com", "#product-strategy", "https://hooks.slack.com/..."]
              },
              "trigger_types": {
                "type": "array",
                "items": {
                  "type": "string",
                  "enum": ["calendar", "roi_threshold", "assumption_invalidation", "opportunity", "cross_team_dependency"]
                },
                "description": "Which trigger types send notifications to this channel"
              }
            }
          }
        }
      }
    },
    "probe_configuration": {
      "type": "object",
      "description": "Configuration for automated AIM probe (Level 2-3)",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether automated probe is enabled",
          "default": false
        },
        "cadence": {
          "type": "string",
          "enum": ["daily", "weekly", "biweekly"],
          "description": "How often probe runs",
          "default": "weekly"
        },
        "data_sources": {
          "type": "array",
          "description": "Data sources probe should monitor",
          "items": {
            "type": "object",
            "required": ["source_type", "connection"],
            "properties": {
              "source_type": {
                "type": "string",
                "enum": ["analytics", "user_feedback", "git_activity", "support_tickets", "sales_crm"],
                "description": "Type of data source"
              },
              "connection": {
                "type": "string",
                "description": "Connection identifier (API key, database connection, etc.)",
                "examples": ["mixpanel_api_key", "postgres://...", "salesforce_connection"]
              },
              "metrics_to_monitor": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Specific metrics to extract",
                "examples": ["daily_active_users", "feature_adoption_rate", "nps_score"]
              }
            }
          }
        },
        "synthesizer_prompt": {
          "type": "string",
          "description": "Custom prompt for Synthesizer when running probe",
          "examples": ["Analyze metrics for anomalies >20% from baseline. Flag if potential waste exceeds $10K."]
        }
      }
    }
  }
}
